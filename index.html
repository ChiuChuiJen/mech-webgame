<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>機甲：廢土升等掉寶 (V0.2.2)</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="styles.css?v=0.2.2" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">🤖</div>
      <div class="titles">
        <div class="name">機甲：廢土升等掉寶</div>
        <div class="ver">V0.2.2 · GitHub Pages 可直接跑</div>
      </div>
    </div>
    <div class="top-actions">
      <button id="btnSave" class="btn">存檔</button>
      <button id="btnReset" class="btn btn-danger">重置</button>
    </div>
  
      <button id="btnSettings" class="iconbtn" title="設定" aria-label="設定">⚙️</button>

</header>

  <main class="layout">
    <section class="card">
      <div class="card-hd">
        <h2>駕駛員 / 機甲狀態</h2>
        <div class="pill" id="pillArea">區域：新手區</div>
      </div>

      <div class="grid2">
        <div class="statbox">
          <div class="statrow"><span>等級</span><b id="lv">1</b></div>
          <div class="statrow"><span>經驗</span><b id="xp">0</b></div>
          <div class="bar"><div id="xpBar" class="fill"></div></div>

          <div class="statrow"><span>生命</span><b id="hp">0</b></div>
          <div class="bar"><div id="hpBar" class="fill"></div></div>

          <div class="statrow"><span>能量</span><b id="en">0</b></div>
          <div class="bar"><div id="enBar" class="fill"></div></div>

          <div class="statrow"><span>金幣</span><b id="gold">0</b></div>
          <div class="hint">提示：探索 → 戰鬥 → 掉寶/升等 → 配裝</div>
        </div>

        <div class="equipbox">
          <div class="subhd">
            <h3>裝備</h3>
            <div class="small" id="setProgress">套裝：—</div>
          </div>

          <div class="equipgrid">
            <div class="slot">
              <div class="lbl">右手武器</div>
              <button class="slotbtn" id="eqWeaponR">—</button>
            </div>
            <div class="slot">
              <div class="lbl">左手武器</div>
              <button class="slotbtn" id="eqWeaponL">—</button>
            </div>
            <div class="slot">
              <div class="lbl">頭部模組</div>
              <button class="slotbtn" id="eqHead">—</button>
            </div>
            <div class="slot">
              <div class="lbl">軀幹裝甲</div>
              <button class="slotbtn" id="eqBody">—</button>
            </div>
            <div class="slot">
              <div class="lbl">手臂模組</div>
              <button class="slotbtn" id="eqArms">—</button>
            </div>
            <div class="slot">
              <div class="lbl">腿部模組</div>
              <button class="slotbtn" id="eqLegs">—</button>
            </div>
            <div class="slot">
              <div class="lbl">推進器</div>
              <button class="slotbtn" id="eqBooster">—</button>
            </div>
            <div class="slot">
              <div class="lbl">核心模組</div>
              <button class="slotbtn" id="eqCore">—</button>
            </div>
          </div>

          <div class="subhd" style="margin-top:10px;">
            <h3>技能槽（戰鬥可用）</h3>
            <div class="small">在「技能」分頁設定</div>
          </div>
          <div class="equipgrid" style="grid-template-columns:repeat(3,minmax(0,1fr));">
            <div class="slot">
              <div class="lbl">技能槽 1</div>
              <button class="slotbtn" id="eqSkill1">—</button>
            </div>
            <div class="slot">
              <div class="lbl">技能槽 2</div>
              <button class="slotbtn" id="eqSkill2">—</button>
            </div>
            <div class="slot">
              <div class="lbl">技能槽 3</div>
              <button class="slotbtn" id="eqSkill3">—</button>
            </div>
          </div>

          <div class="totals">
            <div class="kpi"><span>攻擊</span><b id="atk">0</b></div>
            <div class="kpi"><span>防禦</span><b id="def">0</b></div>
            <div class="kpi"><span>暴擊%</span><b id="crit">0</b></div>
            <div class="kpi"><span>吸血%</span><b id="ls">0</b></div>
          </div>
          <div class="small muted" id="passives">被動：—</div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-hd">
        <h2>行動</h2>
        <div class="tabs">
          <button class="tab active" data-tab="explore">探索</button>
          <button class="tab" data-tab="battle">戰鬥</button>
          <button class="tab" data-tab="inventory">背包</button>
          <button class="tab" data-tab="skills">技能</button>
          <button class="tab" data-tab="shop">雜貨店</button>
          <button class="tab" data-tab="log">歷程</button>
        </div>
      </div>

      <div class="tabpanes">
        <div class="pane" id="pane-skills">
          <div class="row" style="justify-content:space-between; align-items:center;">
            <div>
              <div class="muted">已學會技能</div>
              <div class="small">在此裝備你要在戰鬥中使用的技能（3 格）</div>
            </div>
            <div class="row" style="gap:8px;">
              <span class="badge">槽1：<b id="skEq1">—</b></span>
              <span class="badge">槽2：<b id="skEq2">—</b></span>
              <span class="badge">槽3：<b id="skEq3">—</b></span>
            </div>
          </div>
          <div id="skillList" class="list"></div>
        </div>

        <div class="pane active" id="pane-explore">
          <div class="row">
            <button id="btnExplore" class="btn btn-primary">開始探索</button>
            <button id="btnRest" class="btn">休整 (+HP/EN)</button>
            <div class="pill" id="pillFloor">探索：1F</div>
            <button id="btnPrevFloor" class="btn">上一層</button>
            <button id="btnNextFloor" class="btn">下一層</button>

            <div class="small muted">探索會觸發戰鬥；休整最多回到上限。</div>
          </div>

          <div class="battlebox">
            <div class="enemy">
              <div class="enemyname" id="enemyName">—</div>
              <div class="statrow"><span>生命</span><b id="enemyHp">—</b></div>
              <div class="bar"><div id="enemyHpBar" class="fill"></div></div>
              <div class="small muted" id="enemyInfo">—</div>
            </div>
            <div class="controls">
              <button id="btnAttack" class="btn btn-primary" disabled>普通攻擊</button>
              <button id="btnSkill" class="btn" disabled>技能 (耗能)</button>
              <button id="btnFlee" class="btn btn-danger" disabled>撤退</button>
              <div class="small muted" id="battleHint">先探索以遇敵。</div>
            </div>
          </div>
        </div>

        <div class="pane" id="pane-battle">
          <div class="small muted">戰鬥也會在「探索」分頁顯示。你可以在那邊直接操作。</div>
        </div>

        <div class="pane" id="pane-inventory">
          <div class="row">
            <button id="btnSort" class="btn">排序</button>
            <button id="btnSalvageJunk" class="btn btn-danger">分解普通 (換金幣)</button>
            <div class="small muted">點物品可：裝備 / 解除 / 販售 / 分解。</div>
          </div>
          <div id="invList" class="list"></div>
        </div>

        <div class="pane" id="pane-shop">
          <div class="row">
            <button id="btnRerollShop" class="btn">刷新</button>
            <div class="small muted">雜貨店會賣：基礎武器/防具/補給。</div>
          </div>
          <div id="shopList" class="list"></div>
        </div>

        <div class="pane" id="pane-log">
          <div class="row">
            <button id="btnClearLog" class="btn btn-danger">清空</button>
            <div class="small muted">只保留最新 10 筆，超過以捲軸瀏覽。</div>
          </div>
          <div id="logBox" class="log"></div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-hd">
        <h2>說明</h2>
      </div>
      <ul class="bullets">
        <li>這是一個純前端小型 RPG（單檔可跑），適合直接丟到 GitHub Pages。</li>
        <li>支援：升等、掉寶、雙持（右手/左手不同被動）、套裝 2/4 效果、雜貨店、存檔（localStorage）。</li>
        <li>你可以直接改 <code>data/*.json</code> 來調平衡，不用改程式。</li>
      </ul>
    </section>
  </main>

  <dialog id="modal" class="modal">
    <div class="modal-inner">
      <div class="modal-hd">
        <h3 id="modalTitle">—</h3>
        <button id="modalClose" class="iconbtn" aria-label="close">✕</button>
      </div>
      <div id="modalBody" class="modal-bd"></div>
      <div class="modal-ft" id="modalActions"></div>
    </div>
  </dialog>

  <script src="main.js?v=0.2.2"></script>

  
  <dialog id="battleModal" class="battleModal">
    <div class="bmHeader">
      <div class="bmTitle">戰鬥 <span class="badge" id="bmTurn">回合 1</span></div>
      <div class="bmHeaderRight">
        <label class="bmAuto">
          <input type="checkbox" id="bmAutoToggle">
          <span>自動戰鬥</span>
        </label>
        <button class="iconbtn bmClose" id="bmClose" title="關閉" aria-label="關閉">✕</button>
      </div>
    </div>

    <div class="bmGrid">
      <div class="bmCard">
        <div class="bmCardTitle">敵方</div>
        <div id="bmEnemyName" class="bmBig">—</div>
        <div class="bmRow"><span>HP</span><span id="bmEnemyHp">—</span></div>
        <div class="bmRow"><span>攻擊</span><span id="bmEnemyAtk">—</span></div>
        <div class="bmRow"><span>防禦</span><span id="bmEnemyDef">—</span></div>
        <div class="bmBar"><div id="bmEnemyHpBar" class="fill"></div></div>
        <div class="bmStatus" id="bmEnemyStatus"></div>
      </div>

      <div class="bmCard">
        <div class="bmCardTitle">我方</div>
        <div id="bmPlayerName" class="bmBig">機甲</div>
        <div class="bmRow"><span>HP</span><span id="bmPlayerHp">—</span></div>
        <div class="bmRow"><span>MP</span><span id="bmPlayerMp">—</span></div>
        <div class="bmRow"><span>攻擊</span><span id="bmPlayerAtk">—</span></div>
        <div class="bmRow"><span>防禦</span><span id="bmPlayerDef">—</span></div>
        <div class="bmBar"><div id="bmPlayerHpBar" class="fill"></div></div>
        <div class="bmBar"><div id="bmPlayerMpBar" class="fill"></div></div>
        <div class="bmStatus" id="bmPlayerStatus"></div>
      </div>

      <div class="bmCard bmLog">
        <div class="bmCardTitle">即時戰鬥歷程</div>
        <div id="bmLogBox" class="bmLogBox"></div>
      </div>

      <div class="bmCard bmActions">
        <div class="bmCardTitle">技能列表</div>
        <div class="bmSkills" id="bmSkills"></div>

        <div class="bmBtns" style="margin-top:10px;">
          <button id="bmAttack" class="btn btn-primary">普攻</button>
          <button id="bmFlee" class="btn">撤退</button>
        </div>

        <div id="bmHint" class="muted" style="margin-top:10px;">—</div>

        <div id="bmRewards" class="bmRewards" style="display:none;">
          <div class="bmRewardsTitle">戰鬥結算</div>
          <div class="bmRewardsMeta" id="bmRewardsMeta"></div>
          <div class="bmLoot" id="bmLoot"></div>
          <div class="bmEndBtns">
            <button id="bmContinue" class="btn btn-primary">繼續探索</button>
            <button id="bmLeave" class="btn">離開</button>
          </div>
        </div>
      </div>
    </div>
  </dialog>



  <dialog id="weaponHandModal" class="miniModal">
    <div class="mmHeader">
      <div class="mmTitle">選擇武器裝備位置</div>
      <button class="iconbtn" id="whClose" aria-label="關閉">✕</button>
    </div>
    <div class="mmBody">
      <div class="muted" id="whName">—</div>
      <div class="mmBtns">
        <button class="btn btn-primary" id="whRight">裝備右手</button>
        <button class="btn btn-primary" id="whLeft">裝備左手</button>
      </div>
    </div>
  </dialog>


  <dialog id="changelogModal" class="miniModal">
    <div class="mmHeader">
      <div class="mmTitle">版本更新歷程</div>
      <button class="iconbtn" id="clClose" aria-label="關閉">✕</button>
    </div>
    <div class="mmBody">
      <div id="clAll" class="clList"></div>
    </div>
  </dialog>

<div id="clPreview"></div>
</body>
</html>
